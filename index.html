<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>èµ„æ–™é©±åŠ¨ï½œæ—¥å†æ‰“å¡ï¼ˆ8.20â€“12.20ï¼‰</title>
<style>
  :root{
    --bg:#0b1220; --card:#111a2b; --muted:#8aa4c7; --text:#eaf2ff; --accent:#7aa2ff; --ok:#51d88a; --warn:#ffcc66; --bad:#ff6b6b; --line:#22314f;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  body{margin:0; background:radial-gradient(1000px 500px at 20% -10%, #17233a, #0b1220 55%), var(--bg); color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "PingFang SC", "Noto Sans CJK SC", "Hiragino Sans GB", "Microsoft YaHei", Arial, sans-serif;}
  header{position:sticky; top:0; z-index:10; backdrop-filter:saturate(180%) blur(10px); background:linear-gradient(180deg, rgba(17,26,43,.9), rgba(17,26,43,.6)); border-bottom:1px solid #1f2a44}
  .wrap{max-width:1120px; margin:0 auto; padding:18px 20px}
  h1{margin:0 0 6px; font-size:22px}
  .sub{color:var(--muted); font-size:14px}
  .topline{display:grid; grid-template-columns: 1fr auto; gap:12px; align-items:center}
  .kpi{display:flex; gap:12px; flex-wrap:wrap}
  .kpi .card{background:var(--card); padding:10px 12px; border-radius:14px; box-shadow:var(--shadow); display:flex; gap:10px; align-items:center; border:1px solid var(--line)}
  .count{font-weight:700; font-size:18px}
  .btn{background:linear-gradient(180deg, #24385f, #1a2946); color:#cfe0ff; border:1px solid #2a3e68; padding:10px 12px; border-radius:12px; cursor:pointer}
  .btn:active{transform:translateY(1px)}
  main{display:grid; grid-template-columns: 330px 1fr; gap:18px; padding:18px 20px; max-width:1120px; margin:0 auto}
  @media (max-width: 920px){ main{grid-template-columns:1fr} }
  .panel{background:var(--card); border:1px solid var(--line); border-radius:16px; box-shadow:var(--shadow)}
  .panel h2{font-size:16px; margin:0; padding:12px 14px; border-bottom:1px solid #1f2a44; color:#d7e6ff}
  .panel .content{padding:12px 14px}
  /* Calendar */
  .cal{display:grid; gap:8px}
  .cal .nav{display:flex; justify-content:space-between; align-items:center}
  .cal .grid{display:grid; grid-template-columns: repeat(7, 1fr); gap:6px}
  .day, .wd{padding:8px; text-align:center; border-radius:10px}
  .wd{color:#8fb0ff; font-size:12px}
  .day{background:#0f182a; border:1px solid #203150; cursor:pointer; position:relative}
  .day.mute{opacity:.45}
  .day.today{outline:2px solid var(--accent)}
  .day.selected{background:linear-gradient(180deg, #1f2e4c, #18263e); border-color:#3c55a3}
  .day .mini{position:absolute; bottom:6px; left:50%; transform:translateX(-50%); height:6px; width:60%; background:#1a2946; border-radius:999px; overflow:hidden}
  .day .mini > i{display:block; height:100%; background:#3b82f6; width:0%}
  .legend{display:flex; gap:8px; flex-wrap:wrap; margin-top:6px; font-size:12px; color:#9cb5dc}
  .legend span{display:inline-flex; align-items:center; gap:6px}
  .dot{width:8px; height:8px; border-radius:50%}
  /* Tasks */
  .tasks-head{display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap}
  .tasks{display:grid; gap:10px}
  .task{display:grid; grid-template-columns: 100px 1fr auto; gap:10px; align-items:center; padding:10px; border:1px solid var(--line); background:#0f182a; border-radius:12px}
  .time{font-weight:700; color:#afc8ff}
  .title{display:flex; align-items:center; gap:10px}
  .title label{cursor:pointer}
  .tag{font-size:11px; color:#9cb5dc; padding:4px 8px; border:1px solid #2b3f69; border-radius:999px}
  .cat{font-size:11px; color:#c1d7ff; padding:2px 6px; border:1px dashed #345089; border-radius:8px}
  .tools{display:flex; gap:8px}
  .tools .btn{padding:8px 10px; font-size:12px}
  .muted{color:#9cb5dc}
  /* Custom tasks */
  .custom{display:grid; gap:8px}
  .row{display:grid; grid-template-columns:1.2fr 2fr .8fr auto; gap:8px}
  input, select, textarea{background:#0b1220; color:#dbe8ff; border:1px solid #2a3e68; padding:10px; border-radius:10px}
  textarea{min-height:70px}
  .small{font-size:12px; color:#9cb5dc}
  /* Metrics */
  .metrics{display:grid; grid-template-columns: 1fr 1fr; gap:12px}
  .metrics .box{background:#0f182a; border:1px solid var(--line); border-radius:12px; padding:10px}
  .risk{font-size:13px}
  .risk.ok{color:var(--ok)}
  .risk.warn{color:var(--warn)}
  .risk.bad{color:var(--bad)}
  .footer{padding:14px; color:#99b3db; font-size:12px; border-top:1px solid #1f2a44}
  .copy{white-space:pre-wrap; word-break:break-word; background:#0b1220; border:1px dashed #2a3e68; padding:10px; border-radius:8px}
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="topline">
        <div>
          <h1>èµ„æ–™é©±åŠ¨ï½œæ—¥å†æ‰“å¡</h1>
          <div class="sub">è¦†ç›– <strong>2025-08-20</strong> è‡³ <strong>2025-12-20</strong> Â· ä¾æ®ä½ çš„ä¹¦ç›®è‡ªåŠ¨ç”Ÿæˆæ¯æ—¥ç»†åŒ–ä»»åŠ¡ Â· æœ¬åœ°ç¦»çº¿ä¿å­˜</div>
        </div>
        <div class="kpi">
          <div class="card"><div>è·ç¦»è€ƒè¯•</div><div class="count" id="dCountdown">-- å¤©</div></div>
          <button class="btn" id="exportBtn">å¯¼å‡ºä»Šæ—¥è®°å½•</button>
          <button class="btn" id="resetBtn">é‡ç½®æœ¬æ—¥</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <!-- Left: Calendar & Metrics -->
    <section class="panel">
      <h2>ğŸ“… æ‰“å¡æ—¥å†</h2>
      <div class="content">
        <div class="cal">
          <div class="nav">
            <button class="btn" id="prevMonth">â—€ ä¸Šæœˆ</button>
            <div class="muted" id="monthLabel">--</div>
            <button class="btn" id="nextMonth">ä¸‹æœˆ â–¶</button>
          </div>
          <div class="grid" id="weekdays"></div>
          <div class="grid" id="days"></div>
          <div class="legend">
            <span><span class="dot" style="background:#3b82f6"></span> å­¦ä¹ æ—¥ç¨‹</span>
            <span><span class="dot" style="background:#10b981"></span> æ‰“å¡å®Œæˆ</span>
            <span><span class="dot" style="background:#f59e0b"></span> ä¸´è¿‘è€ƒè¯•</span>
          </div>
        </div>
      </div>
      <h2>ğŸ“ˆ æ¯æ—¥æ•ˆç‡ä¸å‹åŠ›</h2>
      <div class="content">
        <div class="metrics">
          <div class="box">
            <label>æ•ˆç‡è¯„åˆ†ï¼ˆ1-10ï¼‰</label>
            <input type="number" id="effScore" min="1" max="10" step="1" />
            <div class="small">å»ºè®®ï¼š<span id="effSuggest">â€”</span></div>
          </div>
          <div class="box">
            <label>å‹åŠ›è¯„åˆ†ï¼ˆ1-10ï¼‰</label>
            <input type="number" id="stressScore" min="1" max="10" step="1" />
            <div class="small">å»ºè®®ï¼š<span id="stressSuggest">â€”</span></div>
          </div>
        </div>
        <div class="risk" id="riskHint">â€”</div>
      </div>
      <div class="footer">æç¤ºï¼šæ•ˆç‡ < 7 â†’ æ¬¡æ—¥å‡é‡ 15% å¹¶åŠ ä¼‘æ¯ï¼›å‹åŠ› > 7 â†’ å¢åŠ 20â€“30åˆ†é’Ÿæœ‰æ°§/æ‹‰ä¼¸å¹¶é™ä½é¢˜ç›®éš¾åº¦ã€‚</div>
    </section>

    <!-- Right: Tasks -->
    <section class="panel" style="overflow:hidden">
      <h2>âœ… ä»Šæ—¥ä»»åŠ¡ï¼ˆ<span id="phaseName">â€”</span>ï¼‰</h2>
      <div class="content">
        <div class="tasks-head">
          <div class="muted">å½“å‰æ—¥æœŸï¼š<strong id="currentDate">â€”</strong></div>
          <div class="tools">
            <button class="btn" id="checkAll">ä¸€é”®å…¨é€‰</button>
            <button class="btn" id="uncheckAll">æ¸…ç©ºå‹¾é€‰</button>
          </div>
        </div>
        <div class="small" style="margin:8px 0">è¯´æ˜ï¼šå‹¾é€‰ã€æ•ˆç‡/å‹åŠ›è¯„åˆ†ã€å¤‡æ³¨ä¸è‡ªå®šä¹‰ä»»åŠ¡å‡ä¼šè‡ªåŠ¨ç¦»çº¿ä¿å­˜ï¼ˆlocalStorageï¼‰ã€‚</div>
        <div class="tasks" id="taskList"></div>
      </div>

      <h2>ğŸ§© è‡ªå®šä¹‰ä»»åŠ¡</h2>
      <div class="content custom">
        <div class="row">
          <input id="cTime" placeholder="æ—¶é—´ å¦‚ 20:20â€“21:00" />
          <input id="cTitle" placeholder="ä»»åŠ¡æ ‡é¢˜ å¦‚ è‹±è¯­é¢å¤–é˜…è¯» / å¤ç›˜ç¬”è®°" />
          <select id="cCat">
            <option value="è‡ªå®šä¹‰">è‡ªå®šä¹‰</option>
            <option value="è‹±è¯­">è‹±è¯­</option>
            <option value="æ•°å­¦">æ•°å­¦</option>
            <option value="æ”¿æ²»">æ”¿æ²»</option>
            <option value="ä¸“ä¸šè¯¾">ä¸“ä¸šè¯¾</option>
            <option value="è¿åŠ¨">è¿åŠ¨</option>
            <option value="é¥®é£Ÿ">é¥®é£Ÿ</option>
            <option value="ä¼‘æ¯">ä¼‘æ¯</option>
          </select>
          <button class="btn" id="addCustom">æ·»åŠ </button>
        </div>
        <div id="customList" class="tasks" style="margin-top:8px"></div>
      </div>

      <h2>ğŸ“ ä»Šæ—¥å¤‡æ³¨</h2>
      <div class="content">
        <textarea id="notes" placeholder="è®°å½•ä»Šæ—¥æ”¶è· 3 æ¡ / é”™é¢˜ 1-2 ä¸ª / å¿ƒæ€ä¸€å¥è¯"></textarea>
      </div>
    </section>
  </main>

<script>
(function(){
  // ====== æ—¶é—´æ®µ & é˜¶æ®µ ======
  const EXAM_DATE = new Date('2025-12-20T00:00:00');
  const PHASES = [
    {k:'p1', name:'é˜¶æ®µä¸€Â·é«˜æ•ˆæ‰“åŸºç¡€ï¼ˆ8.20â€“9.30ï¼‰', start:'2025-08-20', end:'2025-09-30'},
    {k:'p2', name:'é˜¶æ®µäºŒÂ·å¼ºåŒ–çªç ´ï¼ˆ10.1â€“10.31ï¼‰', start:'2025-10-01', end:'2025-10-31'},
    {k:'p3', name:'é˜¶æ®µä¸‰Â·çœŸé¢˜åˆ¶èƒœï¼ˆ11.1â€“11.30ï¼‰', start:'2025-11-01', end:'2025-11-30'},
    {k:'p4', name:'é˜¶æ®µå››Â·å®Œç¾æ”¶å®˜ï¼ˆ12.1â€“12.20ï¼‰', start:'2025-12-01', end:'2025-12-20'},
  ];

  // ====== å·¥å…· ======
  const $ = (s,root=document)=>root.querySelector(s);
  const $$ = (s,root=document)=>Array.from(root.querySelectorAll(s));
  const fmtDate = (d)=>d.toISOString().slice(0,10);
  const parseYMD = (s)=>{ const [y,m,day]=s.split('-').map(Number); return new Date(y,m-1,day); };
  const daysBetween = (a,b)=>Math.round((parseYMD(b)-parseYMD(a))/(1000*3600*24))+1;
  const inRange = (d, start, end)=> d>=parseYMD(start) && d<=parseYMD(end);
  const getPhase = (d)=> PHASES.find(p=>inRange(d, p.start, p.end));
  const dayIndexInPhase = (d, p)=> Math.floor((d-parseYMD(p.start))/(1000*3600*24)); // 0-based

  // ====== ä¹¦ç›®é©±åŠ¨ä»»åŠ¡åºåˆ—ï¼ˆæŒ‰é˜¶æ®µï¼‰ ======
  // â€”â€” æ•°å­¦ â€”â€”
  const zhangyu30 = Array.from({length:30}, (_,i)=>`å¼ å®‡ã€ŠåŸºç¡€30è®²ã€‹Â·ç¬¬ ${i+1} è®²`);
  const zhangyu36 = Array.from({length:36}, (_,i)=>`å¼ å®‡ã€Šå¼ºåŒ–36è®²ã€‹Â·ç¬¬ ${i+1} è®²`);
  const zhangyu8set = Array.from({length:8}, (_,i)=>`å¼ å®‡ã€Š8å¥—å·ã€‹Â·ç¬¬ ${i+1} å¥—ï¼ˆå…¨ç¨‹è®¡æ—¶ï¼‰`);
  const zhangyu4set = Array.from({length:4}, (_,i)=>`å¼ å®‡ã€Š4å¥—å·ã€‹Â·ç¬¬ ${i+1} å¥—ï¼ˆå…¨ç¨‹è®¡æ—¶ï¼‰`);
  const lyl660_la = Array.from({length:12}, (_,i)=>`ææ°¸ä¹ã€Šçº¿ä»£Â·åŸºç¡€è®²ä¹‰ã€‹Â·ç¬¬ ${i+1} è®²`);
  const lylTrueImprove = Array.from({length:20}, (_,i)=>`ææ°¸ä¹ã€ŠçœŸé¢˜çœŸåˆ·Â·æé«˜ç¯‡ã€‹Â·ä¸“é¢˜ ${i+1}`);
  const yearsMath = [2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024];

  // â€”â€” è‹±è¯­ â€”â€”
  const yearsEn = Array.from({length:20}, (_,i)=>2006+i); // 2006â€“2025
  const enReadLogic = Array.from({length:20}, (_,i)=>`å”è¿Ÿã€Šé˜…è¯»çš„é€»è¾‘ã€‹Â·ç¬¬ ${i+1} ç« `);
  const enJuju = Array.from({length:50}, (_,i)=>`ç”°é™ã€Šå¥å¥çœŸç ”ã€‹Â·æ¨¡å— ${i+1}ï¼ˆ3â€“5å¥ç²¾ç»ƒï¼‰`);
  const enEssayFuncs = Array.from({length:30}, (_,i)=>`çŸ³é›·é¹ã€Š30ä¸ªåŠŸèƒ½å¥ã€‹Â·åŠŸèƒ½å¥ ${i+1}`);

  // â€”â€” ä¸“ä¸šè¯¾ï¼ˆäº¤æ›¿ï¼šä¿¡å· â†” æ•°ç”µï¼‰ â€”â€”
  const sigChaps = Array.from({length:12}, (_,i)=>`ã€Šä¿¡å·ä¸ç³»ç»Ÿã€‹Â·ç¬¬ ${i+1} ç« `);
  const digChaps = Array.from({length:12}, (_,i)=>`ã€Šæ•°å­—ç”µè·¯ä¸ç³»ç»Ÿè®¾è®¡ã€‹Â·ç¬¬ ${i+1} ç« `);
  const sigTrue = Array.from({length:12}, (_,i)=>`ä¿¡å·ä¸ç³»ç»ŸçœŸé¢˜Â·å¥—é¢˜ ${i+1}`);
  const digTrue = Array.from({length:12}, (_,i)=>`æ•°å­—ç”µè·¯çœŸé¢˜Â·å¥—é¢˜ ${i+1}`);

  // â€”â€” æ”¿æ²» â€”â€”
  const coreKaoan = Array.from({length:16}, (_,i)=>`ã€Šæ ¸å¿ƒè€ƒæ¡ˆã€‹Â·ç¬¬ ${i+1} ç« æ¡†æ¶`);
  const xsr1000 = Array.from({length:16}, (_,i)=>`è‚–ç§€è£ã€Š1000é¢˜ã€‹Â·ç¬¬ ${i+1} ç«  é€‰æ‹©é¢˜ 20â€“30 é¢˜`);
  const xiao8 = Array.from({length:8}, (_,i)=>`ã€Šè‚–å…«ã€‹Â·ç¬¬ ${i+1} å¥—ï¼ˆé€‰æ‹©é¢˜+å¤§é¢˜æ¡†æ¶ï¼‰`);
  const xiao4 = Array.from({length:4}, (_,i)=>`ã€Šè‚–å››ã€‹Â·ç¬¬ ${i+1} å¥—ï¼ˆèƒŒè¯µ+é€‰æ‹©ï¼‰`);

  // å–åºåˆ—é¡¹ï¼ˆè¶Šç•Œæ—¶ç»™å‡ºâ€œå¤ç›˜/å·©å›ºâ€ï¼‰
  const pick = (arr, idx, fallback='é”™é¢˜å·©å›º / æ€»ç»“å¤ç›˜')=> arr[idx] || fallback;

  // ====== é˜¶æ®µæ¨¡æ¿ â†’ ç”Ÿæˆâ€œå½“æ—¥ä»»åŠ¡â€ ======
  function buildDayPlan(date){
    const ph = getPhase(date);
    const tasks = [];
    const idx = dayIndexInPhase(date, ph||{start:fmtDate(date)});

    const add = (t, title, cat)=> tasks.push({t, title, cat});

    // å…±ç”¨ï¼šé¥®é£Ÿ/åˆä¼‘/è¿åŠ¨
    const meals = {
      preBreak:'6:40â€“7:00',
      cardio:'7:00â€“7:30',
      breakfast:'7:30â€“8:00',
      lunch:'12:00â€“12:40',
      nap:'12:40â€“13:30',
      dinner:'18:00â€“18:40',
    };

    if(!ph){
      // éè®¡åˆ’æ—¥ï¼šä¿ç•™ä½œæ¯ä¸è‡ªå­¦
      add(meals.preBreak,'æ—©é¤ï¼ˆé¦™è•‰/é…¸å¥¶ç­‰è½»é£Ÿï¼‰','é¥®é£Ÿ');
      add(meals.cardio,'æ—©èµ·æœ‰æ°§ï¼ˆå¿«èµ°/æ…¢è·‘/è·³ç»³ï¼‰','è¿åŠ¨');
      add(meals.breakfast,'æ—©é¤ï¼ˆä¸»é£Ÿ+ä¼˜è´¨è›‹ç™½ï¼‰','é¥®é£Ÿ');
      add('8:30â€“10:30','è‡ªç”±å¤ä¹  / æŸ¥æ¼è¡¥ç¼º','å¤ç›˜');
      add('10:45â€“12:00','é”™é¢˜æœ¬å›é¡¾','å¤ç›˜');
      add(meals.lunch,'åˆé¤','é¥®é£Ÿ');
      add(meals.nap,'åˆä¼‘ 30â€“40 åˆ†é’Ÿ','ä¼‘æ¯');
      add('14:00â€“17:30','è‡ªä¸»å®‰æ’ï¼ˆé˜…è¯»/ä¸“ä¸šè¯¾/é¡¹ç›®ï¼‰','è‡ªå®šä¹‰');
      add(meals.dinner,'æ™šé¤ï¼ˆæ¸…æ·¡ï¼‰','é¥®é£Ÿ');
      add('19:00â€“21:30','æ”¿æ²»/è‹±è¯­å·©å›ºï¼ˆä»»é€‰ï¼‰','è‡ªå®šä¹‰');
      add('21:30â€“22:00','å½“æ—¥å¤ç›˜','å¤ç›˜');
      return tasks;
    }

    const key = ph.k;

    if(key==='p1'){
      // â€”â€” é˜¶æ®µä¸€ï¼ˆåŸºç¡€ï¼‰ â€”â€”
      add(meals.preBreak,'æ—©é¤ï¼ˆè½»é£Ÿï¼šé¦™è•‰/é…¸å¥¶ï¼‰','é¥®é£Ÿ');
      add(meals.cardio,'æ—©èµ·æœ‰æ°§ï¼ˆRPE 5â€“6ï¼‰','è¿åŠ¨');
      add(meals.breakfast,'æ—©é¤ï¼ˆå…¨éº¦+é¸¡è›‹/ç‰›å¥¶ï¼‰','é¥®é£Ÿ');

      add('8:00â€“8:20', pick(coreKaoan, idx), 'æ”¿æ²»');
      add('8:20â€“8:30','æ•°å­¦é¢„çƒ­ï¼šæ˜¨æ—¥å…¬å¼é€Ÿè§ˆ','æ•°å­¦');
      add('8:30â€“10:30', idx<30? pick(zhangyu30, idx): pick(lyl660_la, idx-30), 'æ•°å­¦');
      add('10:30â€“10:45','ç§¯æä¼‘æ¯ï¼ˆæ‹‰ä¼¸+è¡¥æ°´ï¼‰','ä¼‘æ¯');
      add('10:45â€“12:00', idx<30? `å¼ å®‡ã€Š1000é¢˜ã€‹Â·é…å¥—ç¬¬ ${idx+1} è®²ï¼ˆ15é¢˜ï¼‰` : `ææ°¸ä¹ã€ŠåŸºç¡€660ã€‹Â·çº¿ä»£æ¨¡å— ${idx-29}ï¼ˆ15é¢˜ï¼‰`, 'æ•°å­¦');

      add(meals.lunch,'åˆé¤ï¼ˆä¸ƒåˆ†é¥±ï¼‰','é¥®é£Ÿ');
      add(meals.nap,'åˆä¼‘ 30â€“40 åˆ†é’Ÿ','ä¼‘æ¯');

      add('14:00â€“14:30', pick(enJuju, idx), 'è‹±è¯­');
      add('14:30â€“15:00', pick(enReadLogic, idx), 'è‹±è¯­');
      add('15:00â€“15:50','å¥èº«æˆ¿ï¼ˆåŠ›é‡ï¼šèƒ¸/èƒŒ/è…¿å¾ªç¯ï¼‰','è¿åŠ¨');

      // ä¸“ä¸šè¯¾äº¤æ›¿ï¼šå¶æ•°å¤©â†’ä¿¡å· ä¸ ç³»ç»Ÿï¼›å¥‡æ•°å¤©â†’æ•°å­—ç”µè·¯
      const isSig = idx % 2 === 0;
      const chapIdx = Math.floor(idx/2);
      add('16:00â€“17:30', isSig? pick(sigChaps, chapIdx): pick(digChaps, chapIdx), 'ä¸“ä¸šè¯¾');
      add('17:30â€“18:00', isSig? 'ã€Šä¿¡å·ä¸ç³»ç»Ÿã€‹ï¼šè¯¾åé¢˜ï¼ˆ10â€“15é¢˜ï¼‰' : 'ã€Šæ•°å­—ç”µè·¯ã€‹ï¼šè¯¾åé¢˜ï¼ˆ10â€“15é¢˜ï¼‰', 'ä¸“ä¸šè¯¾');

      add(meals.dinner,'æ™šé¤ï¼ˆæ¸…æ·¡ï¼‰','é¥®é£Ÿ');
      add('19:00â€“20:30', pick(xsr1000, idx), 'æ”¿æ²»');
      add('20:45â€“21:30', `é”™é¢˜æ•´ç†ï¼šå¯¹åº” ${((idx%16)+1)} ç« ï¼ˆå»ºç«‹é”™å› â†’è§£æ³•ï¼‰`, 'æ”¿æ²»');
      add('21:30â€“22:00','å½“æ—¥å¤ç›˜ï¼ˆæ”¶è·/é”™é¢˜/å¿ƒæ€ï¼‰','å¤ç›˜');
    }

    if(key==='p2'){
      // â€”â€” é˜¶æ®µäºŒï¼ˆå¼ºåŒ–ï¼‰ â€”â€”
      add(meals.preBreak,'æ—©é¤ï¼ˆè½»é£Ÿï¼‰','é¥®é£Ÿ');
      add(meals.cardio,'æœ‰æ°§ï¼ˆRPE 6ï¼‰','è¿åŠ¨');
      add(meals.breakfast,'æ—©é¤ï¼ˆä¸»é¤ï¼‰','é¥®é£Ÿ');

      add('8:00â€“8:30','æ”¿æ²»èƒŒè¯µï¼ˆæ•…äº‹åŒ–/å…³é”®è¯æ³•ï¼‰','æ”¿æ²»');
      add('8:30â€“10:45', pick(zhangyu36, idx), 'æ•°å­¦');
      add('11:00â€“12:00', pick(lylTrueImprove, idx), 'æ•°å­¦');

      add(meals.lunch,'åˆé¤','é¥®é£Ÿ');
      add(meals.nap,'åˆä¼‘ 30â€“40 åˆ†é’Ÿ','ä¼‘æ¯');

      // è‹±è¯­çœŸé¢˜ï¼šæ¯å¤© 1 å¹´ Text1â€“2ï¼ˆæˆ–ä¸€æ•´ç¯‡ï¼‹ç¿»è¯‘ï¼‰
      const y = yearsEn[idx % yearsEn.length];
      add('14:00â€“15:00', `é»„çš®ä¹¦è‹±ä¸€çœŸé¢˜ï¼š${y} å¹´ Text 1â€“2ï¼ˆç²¾è¯»+ç¿»è¯‘ï¼‰`, 'è‹±è¯­');
      add('15:00â€“15:50','å¥èº«æˆ¿ï¼ˆåŠ›é‡+æ ¸å¿ƒï¼Œ40â€“50minï¼‰','è¿åŠ¨');

      add('16:00â€“18:00', (idx%2===0)? `ã€Šä¿¡å·ä¸ç³»ç»Ÿã€‹ä¸“é¢˜å¤ç›˜ï¼ˆå·ç§¯/é¢‘åŸŸ/é‡‡æ ·ï¼‰` : `ã€Šæ•°å­—ç”µè·¯ã€‹ä¸“é¢˜å¤ç›˜ï¼ˆç»„åˆ/æ—¶åº/è§¦å‘å™¨ï¼‰`, 'ä¸“ä¸šè¯¾');

      add(meals.dinner,'æ™šé¤','é¥®é£Ÿ');
      add('19:00â€“20:30','æ”¿æ²»äºŒè½®åˆ·é¢˜ï¼š1000é¢˜é”™é¢˜å›ç‚‰ + æ–°é¢˜ 20â€“30 é¢˜','æ”¿æ²»');
      add('20:30â€“21:30','æ”¿æ²»çœŸé¢˜é€‰æ‹©é¢˜ï¼ˆé€‰é¡¹åˆ†ææ³•ï¼‰','æ”¿æ²»');
      add('21:30â€“22:00','è·¨ç§‘å¤ç›˜ï¼šé”™é¢˜æ¨¡å¼æ¨ªå‘å¯¹æ¯”','å¤ç›˜');
    }

    if(key==='p3'){
      // â€”â€” é˜¶æ®µä¸‰ï¼ˆçœŸé¢˜åˆ¶èƒœï¼‰ â€”â€”
      add(meals.preBreak,'æ—©é¤ï¼ˆè½»é£Ÿï¼‰','é¥®é£Ÿ');
      add(meals.cardio,'æœ‰æ°§ï¼ˆè½»ï¼‰','è¿åŠ¨');
      add(meals.breakfast,'æ—©é¤ï¼ˆä¸»é¤ï¼‰','é¥®é£Ÿ');

      add('7:30â€“8:20', pick(enEssayFuncs, idx), 'è‹±è¯­');
      add('8:20â€“8:50', `æ”¿æ²»ï¼š${pick(xiao8, Math.floor(idx/4))}Â·è¦ç‚¹èƒŒè¯µ`, 'æ”¿æ²»');

      const yMath = yearsMath[idx % yearsMath.length];
      add('9:00â€“11:30', `æ•°å­¦çœŸé¢˜ï¼ˆè®¡æ—¶ï¼‰ï¼š${yMath} å¹´æ•´å·`, 'æ•°å­¦');
      add('11:30â€“12:00','æ•°å­¦å¿«é€Ÿé”™é¢˜åˆ†ç±»ï¼ˆè¯¦ææ”¾æ™šé—´/æ¬¡æ—¥ï¼‰','æ•°å­¦');

      add(meals.lunch,'åˆé¤','é¥®é£Ÿ');
      add(meals.nap,'åˆä¼‘ 30â€“40 åˆ†é’Ÿ','ä¼‘æ¯');

      const yEn = yearsEn[(idx+8) % yearsEn.length];
      add('14:00â€“16:00', `è‹±è¯­çœŸé¢˜å¥—å·ï¼š${yEn} å¹´ï¼ˆå®Œå½¢+é˜…è¯»+æ–°é¢˜å‹/ç¿»è¯‘ï¼‰`, 'è‹±è¯­');
      add('16:10â€“16:40','å¥èº«æˆ¿ï¼ˆè½»é‡+æ‹‰ä¼¸ï¼‰','è¿åŠ¨');

      const isSig = idx % 2 === 0; const tIdx = Math.floor(idx/2);
      add('17:10â€“18:30', isSig? pick(sigTrue, tIdx): pick(digTrue, tIdx), 'ä¸“ä¸šè¯¾');

      add('18:30â€“19:00','æ™šé¤','é¥®é£Ÿ');
      add('19:30â€“21:00','æ”¿æ²»ï¼šè‚–å…«ç»ƒä¹  + å¤§é¢˜æ¡†æ¶ä¹¦å†™ï¼ˆæŒ‰ç­”é¢˜å¡ï¼‰','æ”¿æ²»');
      add('21:00â€“22:00','å¤šç§‘é”™é¢˜æ•´ç†ï¼ˆæ¨ªå‘å¯¹æ¯”ï¼‰','å¤ç›˜');
    }

    if(key==='p4'){
      // â€”â€” é˜¶æ®µå››ï¼ˆæ”¶å®˜ï¼‰ â€”â€”
      add(meals.preBreak,'æ—©é¤ï¼ˆè½»é£Ÿï¼‰','é¥®é£Ÿ');
      add(meals.cardio,'æœ‰æ°§ï¼ˆå¯ç¼©å‡æˆ–æ”¹æ•£æ­¥ï¼‰','è¿åŠ¨');
      add(meals.breakfast,'æ—©é¤ï¼ˆä¸»é¤ï¼‰','é¥®é£Ÿ');

      add('7:30â€“8:30', pick(xiao4, Math.floor(idx/5)), 'æ”¿æ²»');
      // æ•°å­¦å†²åˆºå·ï¼šå…ˆ 8 å¥—å·ï¼Œå† 4 å¥—å·ï¼Œä½™é‡ç”¨äºé”™é¢˜/é¢„æµ‹å·
      const mz = idx < 8 ? zhangyu8set[idx] : (idx < 12 ? zhangyu4set[idx-8] : `çœŸé¢˜é”™é¢˜å›é¡¾/é¢„æµ‹é¢˜ï¼ˆç¬¬ ${idx-11} å¤©ï¼‰`);
      add('8:40â€“11:40', mz, 'æ•°å­¦');

      add(meals.lunch,'åˆé¤','é¥®é£Ÿ');
      add(meals.nap,'åˆä¼‘ 30â€“40 åˆ†é’Ÿ','ä¼‘æ¯');

      const yEn = yearsEn[(idx+12)%yearsEn.length];
      add('14:10â€“17:10', `è‹±è¯­å†²åˆºå·ï¼š${yEn} å¹´ + ä½œæ–‡ï¼ˆæ¨¡æ¿â†’ä¸ªæ€§åŒ–å¥å¼ï¼‰`, 'è‹±è¯­');
      add('17:40â€“18:10','å¥èº«æˆ¿ï¼ˆæ”¾æ¾ï¼šæ‹‰ä¼¸/å¼¹åŠ›å¸¦/å‘¼å¸ï¼‰','è¿åŠ¨');

      add('18:10â€“18:40','æ™šé¤','é¥®é£Ÿ');
      add('18:40â€“20:10','ä¸“ä¸šè¯¾ï¼šæ ¸å¿ƒè€ƒç‚¹å›é¡¾ï¼ˆçœŸé¢˜é«˜é¢‘ï¼‰','ä¸“ä¸šè¯¾');
      add('20:20â€“22:00','æ”¿æ²»ï¼šè‚–å››å…¨å¥—ç»ƒä¹ ï¼ˆç­”é¢˜è§„èŒƒ/å­—æ•°æ§åˆ¶ï¼‰','æ”¿æ²»');
      add('22:00â€“22:30','é”™é¢˜å¿«é€Ÿå›é¡¾ï¼ˆä»…æ ¸å¿ƒï¼‰','å¤ç›˜');
    }

    return tasks;
  }

  // ====== å€’è®¡æ—¶ ======
  function renderCountdown(){
    const now = new Date();
    const diff = Math.ceil((EXAM_DATE - now) / (1000*60*60*24));
    $('#dCountdown').textContent = diff + ' å¤©';
  }

  // ====== æ—¥å† ======
  let current = new Date(new Date().getFullYear(), new Date().getMonth(), 1);
  let selected = new Date();

  function renderWeekdays(){
    const wds = ['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','æ—¥'];
    const wrap = $('#weekdays'); wrap.innerHTML = '';
    wds.forEach(w=>{ const el=document.createElement('div'); el.className='wd'; el.textContent='å‘¨'+w; wrap.appendChild(el); });
  }

  function renderCalendar(){
    $('#monthLabel').textContent = `${current.getFullYear()} å¹´ ${current.getMonth()+1} æœˆ`;
    const first = new Date(current.getFullYear(), current.getMonth(), 1);
    const startDay = (first.getDay()+6)%7; // Monday=0
    const daysWrap = $('#days'); daysWrap.innerHTML='';
    const daysInMonth = new Date(current.getFullYear(), current.getMonth()+1, 0).getDate();
    const totalCells = Math.ceil((startDay + daysInMonth)/7)*7;

    for(let i=0;i<totalCells;i++){
      const cell = document.createElement('div'); cell.className='day';
      const dayNum = i-startDay+1;
      const date = new Date(current.getFullYear(), current.getMonth(), dayNum);
      if(dayNum<=0 || dayNum>daysInMonth){
        cell.classList.add('mute'); cell.textContent='';
      } else {
        cell.textContent = dayNum;
        if(fmtDate(date)===fmtDate(new Date())) cell.classList.add('today');
        if(fmtDate(date)===fmtDate(selected)) cell.classList.add('selected');

        // è¿›åº¦æ¡ï¼ˆå½“æ—¥å®Œæˆåº¦ï¼‰
        const mini = document.createElement('div'); mini.className='mini'; const bar = document.createElement('i'); mini.appendChild(bar); cell.appendChild(mini);
        const rate = getCompletionRate(date);
        bar.style.width = Math.round(rate*100)+'%';

        cell.addEventListener('click', ()=>{ selected = date; renderCalendar(); renderTasks(); saveMeta(); });
      }
      daysWrap.appendChild(cell);
    }
  }

  // ====== å‹¾é€‰å­˜å‚¨ ======
  function k(base, d=selected){ return `${base}:${fmtDate(d)}`; }
  function loadChecks(d=selected){ try{ return JSON.parse(localStorage.getItem(k('checks', d))||'{}'); } catch(e){ return {}; } }
  function saveChecks(obj, d=selected){ localStorage.setItem(k('checks', d), JSON.stringify(obj)); }

  // ====== æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨ ======
  function renderTasks(){
    $('#currentDate').textContent = fmtDate(selected);
    const ph = getPhase(selected);
    $('#phaseName').textContent = ph ? ph.name : 'è‡ªç”±å¤ä¹ /ä¼‘æ•´æ—¥';

    const list = $('#taskList'); list.innerHTML='';
    const checks = loadChecks();

    const tasks = buildDayPlan(selected);
    tasks.forEach((it, idx)=>{
      const row = document.createElement('div'); row.className='task';
      const id = 't'+idx;
      row.innerHTML = `
        <div class="time">${it.t}</div>
        <div class="title">
          <input type="checkbox" id="${id}" ${checks[id]? 'checked':''}>
          <label for="${id}">${it.title}</label>
          <span class="cat">${it.cat}</span>
        </div>
        <div class="tag">èµ„æ–™é©±åŠ¨</div>
      `;
      row.querySelector('input').addEventListener('change', (e)=>{
        checks[id]=e.target.checked; saveChecks(checks); renderCalendar();
      });
      list.appendChild(row);
    });

    // è‡ªå®šä¹‰ä»»åŠ¡
    renderCustom();
    // è¯„åˆ†/å¤‡æ³¨
    loadMetrics(); loadNotes();
  }

  // å®Œæˆç‡
  function getCompletionRate(d){
    const tasks = buildDayPlan(d);
    const total = tasks.length + (JSON.parse(localStorage.getItem(k('custom', d))||'[]').length||0);
    const checks = loadChecks(d);
    const done = Object.values(checks).filter(Boolean).length;
    return total? Math.min(1, done/total) : 0;
  }

  // ====== è‡ªå®šä¹‰ä»»åŠ¡ ======
  function loadCustom(d=selected){ try{ return JSON.parse(localStorage.getItem(k('custom', d))||'[]'); } catch(e){ return []; } }
  function saveCustom(arr, d=selected){ localStorage.setItem(k('custom', d), JSON.stringify(arr)); }
  function renderCustom(){
    const holder = $('#customList'); holder.innerHTML='';
    const arr = loadCustom();
    arr.forEach((it, i)=>{
      const id = 'c'+i; const checks = loadChecks();
      const row = document.createElement('div'); row.className='task';
      row.innerHTML = `
        <div class="time">${it.t||''}</div>
        <div class="title">
          <input type="checkbox" id="${id}" ${checks[id]? 'checked':''}>
          <label for="${id}">${it.title}</label>
          <span class="cat">${it.cat||'è‡ªå®šä¹‰'}</span>
        </div>
        <div class="tools">
          <button class="btn" data-act="up">â†‘</button>
          <button class="btn" data-act="down">â†“</button>
          <button class="btn" data-act="del">åˆ é™¤</button>
        </div>
      `;
      row.querySelector('input').addEventListener('change', (e)=>{
        const checks = loadChecks(); checks[id]=e.target.checked; saveChecks(checks); renderCalendar();
      });
      row.querySelectorAll('button').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const act = btn.dataset.act; const list = loadCustom();
          if(act==='del'){ list.splice(i,1); }
          if(act==='up' && i>0){ const t=list[i-1]; list[i-1]=list[i]; list[i]=t; }
          if(act==='down' && i<list.length-1){ const t=list[i+1]; list[i+1]=list[i]; list[i]=t; }
          saveCustom(list); renderCustom(); renderCalendar();
        });
      });
      holder.appendChild(row);
    });
  }
  $('#addCustom').addEventListener('click', ()=>{
    const t = $('#cTime').value.trim();
    const title = $('#cTitle').value.trim();
    const cat = $('#cCat').value;
    if(!title){ alert('è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜'); return; }
    const arr = loadCustom(); arr.push({t, title, cat}); saveCustom(arr);
    $('#cTime').value=''; $('#cTitle').value=''; renderCustom(); renderCalendar();
  });

  // ====== è¯„åˆ†/å¤‡æ³¨ ======
  function loadMetrics(){ const m = JSON.parse(localStorage.getItem(k('metrics'))||'{}'); $('#effScore').value = m.eff||''; $('#stressScore').value = m.stress||''; updateSuggest(); }
  function saveMetrics(){ const m = { eff: Number($('#effScore').value||0), stress: Number($('#stressScore').value||0) }; localStorage.setItem(k('metrics'), JSON.stringify(m)); updateSuggest(); }
  function updateSuggest(){ const eff = Number($('#effScore').value||0); const stress = Number($('#stressScore').value||0); $('#effSuggest').textContent = eff && eff<7 ? 'æ¬¡æ—¥å‡å°‘ 15% ä»»åŠ¡é‡ + å¢åŠ  30â€“60 åˆ†é’Ÿä¼‘æ¯' : 'ç»´æŒå½“å‰èŠ‚å¥ï¼Œé”™é¢˜å¤ç›˜ä¼˜å…ˆ'; $('#stressSuggest').textContent = stress && stress>7 ? 'åŠ  20â€“30 åˆ†é’Ÿæ‹‰ä¼¸/æœ‰æ°§ï¼Œé™ä½é¢˜ç›®éš¾åº¦' : 'ä¿æŒï¼›ç¡å‰æ”¾æ¾'; const hint=$('#riskHint'); if(eff && eff<7 && stress && stress>7){ hint.textContent='é£é™©ï¼šæ•ˆç‡ä½ä¸”å‹åŠ›é«˜ â†’ å»ºè®® 1 å¤©è°ƒæ•´æœŸï¼ˆè½»é‡å¤ç›˜+è¿åŠ¨+æ—©ç¡ï¼‰'; hint.className='risk bad'; return;} if(eff && eff<7){ hint.textContent='æ•ˆç‡åä½ï¼šé€‚åº¦å‡é‡ + é›†ä¸­æ”»å…‹å•ä¸€å¡ç‚¹'; hint.className='risk warn'; return;} if(stress && stress>7){ hint.textContent='å‹åŠ›åé«˜ï¼šé™ä½éš¾åº¦ + å¢åŠ è¿åŠ¨/ä¼‘æ¯'; hint.className='risk warn'; return;} hint.textContent='çŠ¶æ€è‰¯å¥½ï¼šä¿æŒèŠ‚å¥ï¼Œæ³¨æ„è¡¥æ°´ä¸ç¡çœ '; hint.className='risk ok'; }
  $('#effScore').addEventListener('input', saveMetrics); $('#stressScore').addEventListener('input', saveMetrics);
  function loadNotes(){ $('#notes').value = localStorage.getItem(k('notes'))||''; } function saveNotes(){ localStorage.setItem(k('notes'), $('#notes').value); }
  $('#notes').addEventListener('input', saveNotes);

  // ====== å·¥å…·æŒ‰é’® ======
  $('#checkAll').addEventListener('click', ()=>{ const checks = loadChecks(); $$('#taskList input[type="checkbox"]').forEach(el=>{ el.checked=true; checks[el.id]=true; }); $$('#customList input[type="checkbox"]').forEach(el=>{ el.checked=true; checks[el.id]=true; }); saveChecks(checks); renderCalendar(); });
  $('#uncheckAll').addEventListener('click', ()=>{ const checks = loadChecks(); $$('#taskList input[type="checkbox"]').forEach(el=>{ el.checked=false; checks[el.id]=false; }); $$('#customList input[type="checkbox"]').forEach(el=>{ el.checked=false; checks[el.id]=false; }); saveChecks(checks); renderCalendar(); });
  $('#resetBtn').addEventListener('click', ()=>{ if(!confirm('é‡ç½®å½“å‰æ—¥æœŸçš„æ‰€æœ‰è®°å½•ï¼ˆå‹¾é€‰/è‡ªå®šä¹‰/è¯„åˆ†/ç¬”è®°ï¼‰ï¼Ÿ')) return; localStorage.removeItem(k('checks')); localStorage.removeItem(k('custom')); localStorage.removeItem(k('metrics')); localStorage.removeItem(k('notes')); renderTasks(); renderCalendar(); });
  $('#exportBtn').addEventListener('click', ()=>{ const data = { date: fmtDate(selected), phase: (getPhase(selected)||{}).name||'è‡ªç”±å¤ä¹ ', checks: loadChecks(), custom: loadCustom(), metrics: JSON.parse(localStorage.getItem(k('metrics'))||'{}'), notes: localStorage.getItem(k('notes'))||'' }; const txt = 'ã€æ—¥æœŸã€‘'+data.date+'\nã€é˜¶æ®µã€‘'+data.phase+'\nã€å®Œæˆæƒ…å†µã€‘'+JSON.stringify(data.checks, null, 2)+'\nã€è‡ªå®šä¹‰ä»»åŠ¡ã€‘'+JSON.stringify(data.custom, null, 2)+'\nã€æ•ˆç‡/å‹åŠ›ã€‘'+JSON.stringify(data.metrics)+'\nã€å¤‡æ³¨ã€‘\n'+data.notes; navigator.clipboard.writeText(txt).then(()=>{ alert('å·²å¤åˆ¶ä»Šæ—¥è®°å½•åˆ°å‰ªè´´æ¿ï¼Œå¯ç›´æ¥ç²˜è´´åˆ°å¾®ä¿¡/ç¬”è®°'); }).catch(()=>{ const w = window.open('', '_blank'); w.document.write('<pre class="copy">'+txt.replace(/[&<>]/g, s=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[s]))+'</pre>'); }); });

  // ====== å…ƒæ•°æ®ä¿å­˜ ======
  function saveMeta(){ localStorage.setItem('lastSelectedDate', fmtDate(selected)); }

  // ====== åˆå§‹åŒ– ======
  function init(){
    const last = localStorage.getItem('lastSelectedDate'); if(last){ selected = parseYMD(last); current = new Date(selected.getFullYear(), selected.getMonth(), 1); }
    renderCountdown(); renderWeekdays(); renderCalendar(); renderTasks();
    $('#prevMonth').addEventListener('click', ()=>{ current = new Date(current.getFullYear(), current.getMonth()-1, 1); renderCalendar(); });
    $('#nextMonth').addEventListener('click', ()=>{ current = new Date(current.getFullYear(), current.getMonth()+1, 1); renderCalendar(); });
    setInterval(renderCountdown, 60*1000);
  }
  init();
})();
</script>
</body>
</html>
